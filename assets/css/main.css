@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base theme variables - will be loaded from CSS config files */
:root {
  /* Fallback colors - these will be replaced by theme configs */
  --color-primary: oklch(0.15 0.05 270);
  --color-secondary: oklch(0.25 0.03 270);
  --color-accent: oklch(0.65 0.15 250);
  --color-background: oklch(1 0 0);
  --color-surface: oklch(0.98 0 0);
  --color-text: oklch(0.12 0.02 270);
  --color-text-secondary: oklch(0.45 0.01 270);
  --color-border: oklch(0.94 0 0);
}

/* Map theme config variables to our CSS variables */
:root {
  --color-primary: var(--primary, oklch(0.15 0.05 270));
  --color-secondary: var(--secondary, oklch(0.25 0.03 270));
  --color-accent: var(--accent, oklch(0.65 0.15 250));
  --color-background: var(--background, oklch(1 0 0));
  --color-surface: var(--card, oklch(0.98 0 0));
  --color-text: var(--foreground, oklch(0.12 0.02 270));
  --color-text-secondary: var(--muted-foreground, oklch(0.45 0.01 270));
  --color-border: var(--border, oklch(0.94 0 0));
}

/* Theme classes are now loaded from CSS config files */

/* Base styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background-color: var(--color-background);
  color: var(--color-text);
  line-height: 1.6;
}

/* Smooth transitions for theme changes */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* Enhanced Navigation Hover Effects */
.nav-button-enhanced {
  position: relative;
  overflow: hidden;
  transform-origin: center;
  will-change: transform, box-shadow;
}

.nav-button-enhanced::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
  opacity: 0;
  transform: scale(0.9);
  transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1;
}

.nav-button-enhanced::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: var(--color-primary);
  opacity: 0;
  transform: scale(0.95);
  filter: blur(4px);
  transition: all 0.3s ease-out;
  z-index: 0;
}

.nav-button-enhanced:hover::before {
  opacity: 0.08;
  transform: scale(1);
}

.nav-button-enhanced:hover::after {
  opacity: 0.05;
  transform: scale(1.05);
}

.nav-button-enhanced:hover {
  transform: translateY(-2px) scale(1.1);
  box-shadow: 0 10px 25px -5px var(--color-primary), 0 10px 10px -5px var(--color-primary);
}

.nav-button-enhanced.active {
  transform: translateY(0) scale(1.05);
  box-shadow: 0 20px 40px -10px var(--color-primary);
}

/* Icon animations */
.nav-icon-enhanced {
  position: relative;
  z-index: 10;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  transform-origin: center;
}

.nav-button-enhanced:hover .nav-icon-enhanced {
  transform: scale(1.25) rotate(3deg);
}

/* Special rotations for specific icons */
.nav-button-enhanced:hover .nav-icon-palette {
  transform: scale(1.25) rotate(12deg);
}

.nav-button-enhanced:hover .nav-icon-globe {
  transform: scale(1.25) rotate(6deg);
}

.nav-button-enhanced:hover .nav-icon-menu {
  transform: scale(1.1) rotate(6deg);
}

.nav-button-enhanced:hover .nav-icon-close {
  transform: scale(1.1) rotate(90deg);
}

/* Masonry Grid Styles - 2 Column Layout */
.masonry-grid {
  display: grid;
  grid-template-columns: 1fr;
  grid-auto-rows: 20px;
  gap: 2rem;
  align-items: start;
}

@media (min-width: 768px) {
  .masonry-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
  }
}

.masonry-item {
  break-inside: avoid;
  display: flex;
  flex-direction: column;
}

/* Different heights for masonry effect */
.masonry-short {
  grid-row-end: span 18;
}

.masonry-medium {
  grid-row-end: span 22;
}

.masonry-tall {
  grid-row-end: span 26;
}

/* Alternative CSS-only masonry using columns for better browser support */
@supports not (grid-template-rows: masonry) {
  .masonry-grid {
    display: block;
    columns: 1;
    column-gap: 2rem;
  }
  
  @media (min-width: 768px) {
    .masonry-grid {
      columns: 2;
    }
  }
  
  .masonry-item {
    display: inline-block;
    width: 100%;
    margin-bottom: 2rem;
    break-inside: avoid;
  }
  
  /* Reset grid-row-end for column layout */
  .masonry-short,
  .masonry-medium,
  .masonry-tall {
    grid-row-end: unset;
  }
}

/* Mobile Navigation Enhancements */
@media (max-width: 1023px) {
  /* Mobile menu slide-in animation */
  .mobile-menu-enter {
    animation: mobile-menu-slide-in 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  .mobile-menu-exit {
    animation: mobile-menu-slide-out 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  @keyframes mobile-menu-slide-in {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes mobile-menu-slide-out {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-20px);
    }
  }
  
  /* Mobile panel animations */
  .mobile-panel-enter {
    animation: mobile-panel-slide-down 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  @keyframes mobile-panel-slide-down {
    from {
      opacity: 0;
      transform: translateY(-10px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* Touch-friendly button enhancements */
  .touch-button {
    min-height: 44px;
    min-width: 44px;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }
  
  .touch-button:active {
    transform: scale(0.98);
    transition: transform 0.1s ease-out;
  }
  
  /* Improved mobile navigation item animations */
  .mobile-nav-item {
    transform-origin: center;
    will-change: transform, box-shadow;
  }
  
  .mobile-nav-item:hover {
    transform: translateX(4px) scale(1.02);
  }
  
  .mobile-nav-item:active {
    transform: translateX(2px) scale(0.98);
  }
  
  /* Mobile theme/language control animations */
  .mobile-control-button {
    position: relative;
    overflow: hidden;
  }
  
  .mobile-control-button::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: inherit;
  }
  
  .mobile-control-button:active::before {
    opacity: 0.1;
    transform: scale(1);
  }
  
  /* Ripple effect for mobile interactions */
  .mobile-ripple {
    position: relative;
    overflow: hidden;
  }
  
  .mobile-ripple::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle, var(--color-primary) 0%, transparent 70%);
    opacity: 0;
    transform: scale(0);
    transition: all 0.3s ease-out;
    border-radius: inherit;
    pointer-events: none;
  }
  
  .mobile-ripple:active::after {
    opacity: 0.2;
    transform: scale(1);
    transition: all 0.1s ease-out;
  }
}

/* Enhanced mobile panel positioning and sizing */
@media (max-width: 640px) {
  .mobile-theme-panel,
  .mobile-language-panel {
    position: fixed !important;
    top: auto !important;
    bottom: 120px !important;
    left: 1rem !important;
    right: 1rem !important;
    width: auto !important;
    max-height: 60vh;
    overflow-y: auto;
    z-index: 60;
  }
}

/* Improved touch targets for small screens */
@media (max-width: 480px) {
  .touch-button {
    min-height: 48px;
    min-width: 48px;
  }
  
  .mobile-nav-item {
    min-height: 56px;
    padding: 1rem !important;
  }
  
  .mobile-control-button {
    min-height: 64px;
    padding: 1rem !important;
  }
}

/* Landscape mobile optimizations */
@media (max-height: 500px) and (orientation: landscape) {
  .mobile-menu-container {
    padding: 1rem !important;
  }
  
  .mobile-nav-item {
    padding: 0.75rem 1rem !important;
    min-height: 48px;
  }
  
  .mobile-theme-panel,
  .mobile-language-panel {
    max-height: 40vh;
  }
}

/* Theme Panel Positioning Fix */
.theme-panel-container {
  position: relative;
}

.theme-panel-fixed {
  position: fixed !important;
  left: 4rem !important;
  bottom: 1rem !important;
  z-index: 50 !important;
  transform: none !important;
}

.language-panel-fixed {
  position: fixed !important;
  left: 4rem !important;
  bottom: 1rem !important;
  z-index: 50 !important;
  transform: none !important;
}

/* Prevent layout shifts during theme switching */
.nav-button-stable {
  position: relative;
  transform-origin: center;
  will-change: transform;
}

.nav-button-stable:hover {
  transform: translateY(-2px) scale(1.05);
}

.nav-button-stable.active {
  transform: translateY(0) scale(1.02);
}

/* Focus Management and Accessibility Styles */

/* Enhanced focus indicators for keyboard navigation */
.focus-visible,
*:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
  border-radius: 4px;
}

/* Custom focus ring for interactive elements */
.focus-ring {
  position: relative;
}

.focus-ring::after {
  content: '';
  position: absolute;
  inset: -2px;
  border: 2px solid var(--color-primary);
  border-radius: inherit;
  opacity: 0;
  transform: scale(0.95);
  transition: all 0.2s ease-out;
  pointer-events: none;
  z-index: 10;
}

.focus-ring:focus-visible::after {
  opacity: 1;
  transform: scale(1);
}

/* Navigation button focus styles */
.nav-button-focus {
  position: relative;
}

.nav-button-focus:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--color-background), 0 0 0 4px var(--color-primary);
}

/* Panel focus trap styles */
.focus-trap-container {
  position: relative;
}

.focus-trap-container:focus-within {
  box-shadow: 0 0 0 2px var(--color-primary);
  border-radius: 8px;
}

/* Mobile touch focus indicators */
@media (max-width: 1023px) {
  .mobile-focus-indicator {
    position: relative;
  }
  
  .mobile-focus-indicator:focus-visible {
    outline: none;
    box-shadow: inset 0 0 0 2px var(--color-primary);
  }
  
  .mobile-focus-indicator::before {
    content: '';
    position: absolute;
    inset: -1px;
    border: 2px solid var(--color-primary);
    border-radius: inherit;
    opacity: 0;
    transition: opacity 0.2s ease-out;
    pointer-events: none;
  }
  
  .mobile-focus-indicator:focus-visible::before {
    opacity: 1;
  }
}

/* High contrast focus indicators for accessibility */
@media (prefers-contrast: high) {
  .focus-visible,
  *:focus-visible {
    outline: 3px solid var(--color-primary);
    outline-offset: 3px;
  }
  
  .nav-button-focus:focus-visible {
    box-shadow: 0 0 0 3px var(--color-background), 0 0 0 6px var(--color-primary);
  }
}

/* Focus indicators for panel elements */
.panel-focus-element {
  position: relative;
}

.panel-focus-element:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--color-primary);
  border-radius: 4px;
}

/* Screen reader only content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Skip to content link for screen readers */
.skip-to-content {
  position: absolute;
  top: -40px;
  left: 6px;
  background: var(--color-primary);
  color: var(--color-background);
  padding: 8px;
  text-decoration: none;
  border-radius: 4px;
  z-index: 1000;
  transition: top 0.3s ease;
}

.skip-to-content:focus {
  top: 6px;
}

/* Focus management for modal-like panels */
.modal-focus-trap {
  position: relative;
}

.modal-focus-trap:focus-within {
  box-shadow: 0 0 0 1px var(--color-primary);
}

/* Keyboard navigation indicators */
.keyboard-navigation-active .nav-button-enhanced {
  transition: all 0.2s ease-out;
}

.keyboard-navigation-active .nav-button-enhanced:focus {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 0 0 2px var(--color-background), 0 0 0 4px var(--color-primary);
}

/* Enhanced Tooltip Styles */
.tooltip-enhanced {
  position: absolute;
  z-index: 9999 !important;
  pointer-events: none;
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transform: translateX(-4px);
  transition: opacity 0.2s ease-out, visibility 0.2s ease-out, transform 0.2s ease-out;
  /* Ensure tooltips are always on top */
  isolation: isolate;
}

/* Navigation tooltip styles - ensure they appear on hover */
.nav-button-focus {
  position: relative;
}

.nav-button-focus [role="tooltip"] {
  position: absolute;
  left: 100%;
  margin-left: 0.5rem;
  top: 50%;
  transform: translateY(-50%) translateX(-4px);
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease-out, visibility 0.3s ease-out, transform 0.3s ease-out;
  pointer-events: none;
  white-space: nowrap;
}

.nav-button-focus:hover [role="tooltip"],
.nav-button-focus:focus-visible [role="tooltip"] {
  opacity: 1 !important;
  visibility: visible !important;
  transform: translateY(-50%) translateX(0) !important;
}

.group:hover .tooltip-enhanced,
.group:focus-visible .tooltip-enhanced {
  opacity: 1 !important;
  visibility: visible !important;
  transform: translateX(0);
}

/* Ensure tooltips work on touch devices */
@media (hover: none) and (pointer: coarse) {
  .tooltip-enhanced {
    display: none;
  }
  
  .nav-button-focus [role="tooltip"] {
    display: none;
  }
}

/* Ensure tooltips work even with reduced motion */
@media (prefers-reduced-motion: reduce) {
  .tooltip-enhanced {
    transition: opacity 0.01ms, visibility 0.01ms, transform 0.01ms;
  }
  
  .nav-button-focus [role="tooltip"] {
    transition: opacity 0.01ms, visibility 0.01ms, transform 0.01ms;
  }
  
  .group:hover .tooltip-enhanced,
  .group:focus-visible .tooltip-enhanced,
  .nav-button-focus:hover [role="tooltip"],
  .nav-button-focus:focus-visible [role="tooltip"] {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(-50%) translateX(0) !important;
  }
}

/* Reduced motion preferences - Comprehensive support */
@media (prefers-reduced-motion: reduce) {
  /* Disable all animations and transitions */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  /* Keep tooltips functional */
  [role="tooltip"] {
    transition-duration: 0.01ms !important;
  }
  
  .group:hover [role="tooltip"],
  .group:focus-visible [role="tooltip"] {
    opacity: 1 !important;
    visibility: visible !important;
  }
  
  /* Mobile menu animations */
  .mobile-menu-enter,
  .mobile-menu-exit,
  .mobile-panel-enter {
    animation: none !important;
  }
  
  /* Navigation hover effects */
  .nav-button-enhanced:hover {
    transform: none !important;
    box-shadow: 0 0 0 2px var(--color-primary) !important;
  }
  
  .nav-button-enhanced:hover::before,
  .nav-button-enhanced:hover::after {
    transform: none !important;
    opacity: 0.1 !important;
  }
  
  .nav-icon-enhanced,
  .nav-icon-palette,
  .nav-icon-globe,
  .nav-icon-menu,
  .nav-icon-close {
    transform: none !important;
  }
  
  /* Mobile interactions */
  .mobile-nav-item:hover,
  .mobile-nav-item:active,
  .touch-button:active {
    transform: none !important;
  }
  
  .mobile-ripple::after {
    display: none !important;
  }
  
  .mobile-control-button::before {
    transform: none !important;
    opacity: 0.1 !important;
  }
  
  /* Focus indicators - keep for accessibility but simplify */
  .focus-ring::after,
  .mobile-focus-indicator::before {
    transition: none !important;
    transform: none !important;
  }
  
  .keyboard-navigation-active .nav-button-enhanced:focus {
    transform: none !important;
    box-shadow: 0 0 0 2px var(--color-background), 0 0 0 4px var(--color-primary) !important;
  }
  
  /* Smooth scroll override */
  html {
    scroll-behavior: auto !important;
  }
  
  /* Tailwind animation overrides */
  .animate-fade-in,
  .animate-slide-up,
  .animate-bounce-gentle {
    animation: none !important;
  }
  
  /* Progress indicators - keep functional but remove animations */
  .progress-bar-fill {
    transition: none !important;
  }
  
  /* Back to top button */
  .back-to-top-button {
    transition: opacity 0.01ms !important;
  }
  
  .back-to-top-button:hover {
    transform: none !important;
  }
}

/* CSS custom property based reduced motion support */
:root.reduced-motion,
:root[data-reduced-motion="true"] {
  --animation-duration: 0.01ms;
  --transition-duration: 0.01ms;
  --scroll-behavior: auto;
}

:root.reduced-motion *,
:root[data-reduced-motion="true"] * {
  animation-duration: var(--animation-duration) !important;
  transition-duration: var(--transition-duration) !important;
  scroll-behavior: var(--scroll-behavior) !important;
}

/* Alternative animations for reduced motion users */
.reduced-motion .nav-button-enhanced:hover,
.reduced-motion .nav-button-enhanced:focus {
  outline: 2px solid var(--color-primary) !important;
  outline-offset: 2px !important;
  transform: none !important;
  box-shadow: none !important;
}

.reduced-motion .mobile-nav-item:hover,
.reduced-motion .mobile-nav-item:focus {
  background-color: var(--color-primary) !important;
  color: var(--color-background) !important;
  transform: none !important;
}

/* High contrast mode support for reduced motion */
@media (prefers-contrast: high) and (prefers-reduced-motion: reduce) {
  .nav-button-enhanced:hover,
  .nav-button-enhanced:focus {
    outline: 3px solid var(--color-primary) !important;
    outline-offset: 3px !important;
    background-color: var(--color-primary) !important;
    color: var(--color-background) !important;
  }
}